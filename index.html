<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pustaka Materi Novel - Cendekia Aksara</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #005a9c; --secondary: #004475; --accent: #f7a04a;
            --bg-light: #f8f9fa; --text-dark: #333; --text-light: #666;
            --white: #ffffff; --border: #e0e0e0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --danger: #dc3545; --success: #28a745;
        }

        body { font-family: 'Poppins', sans-serif; background: var(--bg-light); color: var(--text-dark); margin: 0; padding: 0; line-height: 1.6; -webkit-font-smoothing: antialiased; }
        
        header { background: var(--white); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; box-shadow: var(--shadow); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.2rem; color: var(--primary); text-decoration: none; }
        .logo i { font-size: 1.5rem; color: var(--accent); }
        .admin-trigger { font-size: 0.9rem; color: var(--text-light); cursor: pointer; text-decoration: underline; display: flex; align-items: center; gap: 8px; transition: color 0.3s; }

        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        .section-title { font-size: 1.5rem; color: var(--secondary); margin-bottom: 20px; border-left: 5px solid var(--accent); padding-left: 15px; display: flex; align-items: center; justify-content: space-between; }
        
        .featured-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .material-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

        .featured-card, .material-card { 
            background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); 
            transition: transform 0.2s; cursor: pointer; display: flex; flex-direction: column; height: 100%; position: relative;
            border: 1px solid transparent;
        }
        .featured-card:hover, .material-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        
        .featured-img { height: 180px; background-color: #ddd; background-size: cover; background-position: center; position: relative; }
        .material-thumb { height: 160px; background: #eee; position: relative; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .material-thumb img { width: 100%; height: 100%; object-fit: cover; }

        .badge { position: absolute; top: 15px; left: 15px; background: var(--accent); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; z-index: 2; }
        
        .featured-content, .material-info { padding: 15px 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .featured-date { font-size: 0.8rem; color: var(--text-light); margin-bottom: 5px; }
        .featured-title { font-size: 1.1rem; font-weight: 600; margin: 0 0 10px 0; color: var(--secondary); line-height: 1.4; }
        
        .material-type { font-size: 0.75rem; color: var(--accent); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .material-title { font-size: 1rem; font-weight: 600; margin: 5px 0; color: var(--text-dark); }

        .admin-actions {
            position: absolute; top: 10px; right: 10px; z-index: 10;
            display: flex; gap: 8px; opacity: 0; transition: opacity 0.2s;
        }
        .featured-card:hover .admin-actions, .material-card:hover .admin-actions { opacity: 1; }
        
        .action-btn {
            width: 32px; height: 32px; border-radius: 50%; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }

        .filter-bar { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .filter-btn { padding: 8px 20px; border: 1px solid var(--border); background: var(--white); border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; white-space: nowrap; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .btn-more-articles {
            display: block; width: fit-content; margin: 20px auto 40px;
            padding: 10px 25px; background: var(--white); border: 2px solid var(--primary);
            color: var(--primary); border-radius: 30px; font-weight: 600; cursor: pointer;
            transition: 0.3s;
        }

        .ai-indicator {
            background: #e1f5fe; border: 1px solid #b3e5fc; padding: 12px 18px;
            border-radius: 12px; margin-bottom: 25px; font-size: 0.9rem; color: #01579b;
            display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        #detail-view, #archive-view { background: var(--white); min-height: 80vh; border-radius: 12px; box-shadow: var(--shadow); padding: 40px; animation: fadeIn 0.4s ease; }
        .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; color: var(--text-light); font-weight: 600; text-decoration: none; cursor: pointer; }
        
        .detail-title { font-size: 2.2rem; margin: 0 0 10px 0; color: var(--secondary); line-height: 1.3; font-weight: 700; }
        .detail-content { font-family: 'Merriweather', serif; font-size: 1.1rem; color: #2c2c2c; line-height: 1.9; max-width: 800px; margin: 0 auto; }
        
        /* --- ADMIN PANEL --- */
        #admin-panel { display: none; background: white; padding: 30px; margin-top: 30px; border-top: 5px solid var(--primary); border-radius: 12px; box-shadow: var(--shadow); }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        #editor-area { min-height: 250px; border: 1px solid #ccc; border-radius: 6px; padding: 15px; overflow-y: auto; background: white; margin-top: 10px; }
        
        .ai-manual-box {
            background: #f0f7ff; padding: 20px; border-radius: 12px; border: 2px dashed var(--primary); margin-bottom: 30px;
        }

        .btn { padding: 10px 25px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-success { background: var(--success); color: white; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
        .modal.show { display: flex !important; }
        .modal-content { max-width: 400px; padding: 30px; background: var(--white); border-radius: 12px; width: 90%; }
    </style>
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="#" class="logo" onclick="location.reload()">
                <i class="fa-solid fa-feather-pointed"></i>
                <span>Cendekia Aksara</span>
            </a>
            <div id="auth-section">
                <div class="admin-trigger" id="login-btn"><i class="fa-solid fa-lock"></i> Akses Pengajar</div>
            </div>
        </div>
    </header>

    <div id="admin-panel" class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="section-title" style="margin:0; border: none;">Dashboard Bengkel Novel</h2>
            <button class="btn" style="background:#eee; width:auto;" id="hide-admin-panel">Tutup Panel</button>
        </div>

        <!-- FITUR BARU: MANIK-MANIK AKSARA (ORDER ARTIKEL AI) -->
        <div class="ai-manual-box">
            <label style="font-weight: 700; color: var(--primary); display: block; margin-bottom: 10px;">
                <i class="fa-solid fa-robot"></i> Perintah Aksa AI Menulis Topik Khusus
            </label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="ai-manual-topic" class="form-control" style="flex: 1; min-width: 250px;" placeholder="Contoh: Tips menulis bab pertama yang memikat...">
                <button type="button" class="btn btn-success" id="btn-ai-manual" style="width: auto; white-space: nowrap;">
                    <i class="fa-solid fa-paper-plane"></i> Terbitkan via Aksa AI
                </button>
            </div>
            <small style="color: var(--text-light); margin-top: 10px; display: block;">
                *Aksa akan secara otomatis membuat artikel lengkap dengan bedah kutipan sesuai topik di atas.
            </small>
        </div>
        
        <form id="material-form">
            <input type="hidden" id="edit-id" value="">
            <div class="form-group">
                <label>Judul Materi Manual</label>
                <input type="text" id="input-title" class="form-control" placeholder="Tulis judul materi..." required>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                <div class="form-group">
                    <label>Jenis Konten</label>
                    <select id="input-category" class="form-control">
                        <option value="Artikel">Berita & Artikel</option>
                        <option value="Video">Materi Video Bedah</option>
                        <option value="Bacaan">Materi Bacaan Novel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Fokus (Topik)</label>
                    <input type="text" id="input-topic" class="form-control" placeholder="Contoh: Plot, Karakter">
                </div>
            </div>
            <div class="form-group" id="video-url-group" style="display:none; margin-bottom: 15px;">
                <label>Link YouTube</label>
                <input type="url" id="input-youtube" class="form-control">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label>Link Gambar Sampul</label>
                <input type="url" id="input-image" class="form-control">
            </div>
            <div class="form-group">
                <label>Isi Materi / Analisis</label>
                <div id="editor-area" contenteditable="true"></div>
            </div>
            <button type="submit" class="btn btn-primary" id="save-btn" style="margin-top:20px;">Terbitkan Manual</button>
        </form>
    </div>

    <div id="public-view" class="container">
        <div id="ai-status-container"></div>

        <h2 class="section-title">
            <span><i class="fa-regular fa-newspaper"></i> Kabar Cendekia</span>
        </h2>
        <div class="featured-grid" id="featured-container">
            <div style="text-align: center; padding: 40px; color: #999;">Memuat Kabar...</div>
        </div>
        
        <button class="btn-more-articles" id="btn-open-archive">
            Arsip Kabar Sebelumnya <i class="fa-solid fa-arrow-right"></i>
        </button>

        <h2 class="section-title">
            <span><i class="fa-solid fa-book-journal-whills"></i> Pustaka Materi & Bedah Novel</span>
        </h2>
        <div class="filter-bar">
            <button class="filter-btn active" onclick="filterMaterials('all')">Semua Materi</button>
            <button class="filter-btn" onclick="filterMaterials('Video')">Bedah Video</button>
            <button class="filter-btn" onclick="filterMaterials('Bacaan')">Analisis Teks</button>
        </div>
        <div class="material-list" id="library-container"></div>
    </div>

    <div id="archive-view" class="container hidden">
        <div onclick="closeArchive()" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Kembali</div>
        <h1 class="detail-title">Arsip Artikel & Kegiatan</h1>
        <div id="archive-content"></div>
    </div>

    <div id="detail-view" class="container hidden">
        <div onclick="closeDetail()" class="back-btn"><i class="fa-solid fa-arrow-left"></i> Kembali</div>
        <div id="view-content-rendered"></div>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2 style="text-align:center; margin-top:0;">Login Pengajar</h2>
            <form id="login-form">
                <div style="margin-bottom:15px;"><label>Email</label><input type="email" id="login-email" class="form-control" required></div>
                <div style="margin-bottom:20px;"><label>Password</label><input type="password" id="login-password" class="form-control" required></div>
                <button type="submit" class="btn btn-primary">Masuk</button>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, getDocs, serverTimestamp, doc, deleteDoc, updateDoc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyDpUWUIzPXIZN6rrNtsIqcL6VfOE2RLVl0", 
            authDomain: "mading-cf676.firebaseapp.com", 
            projectId: "mading-cf676", 
            storageBucket: "mading-cf676.firebasestorage.app", 
            messagingSenderId: "72175203671", 
            appId: "1:72175203671:web:7a0676a55beb64bc96ba12" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const apiKey = "AIzaSyD8MGKr8t4Los0gmdRFUaRbLidtPhIzgnw"; 

        let allMaterials = [];
        let currentUser = null;

        window.addEventListener('DOMContentLoaded', () => {
            loadMaterials();
            setupAuthListener();
            checkAndTriggerAI(); 
        });

        // --- SISTEM AUTO PUBLISH HARIAN ---
        async function checkAndTriggerAI() {
            const statusBox = document.getElementById('ai-status-container');
            const today = new Date().toLocaleDateString('en-CA');
            const now = new Date();
            if (now.getHours() < 9) return; 

            const aiLogRef = doc(db, 'system', 'ai_publish_log');
            const aiLogSnap = await getDoc(aiLogRef);
            if (aiLogSnap.exists() && aiLogSnap.data().lastDate === today) return;

            statusBox.innerHTML = `<div class="ai-indicator"><i class="fa-solid fa-feather fa-bounce"></i> Aksa AI sedang membedah sebuah novel untuk materi pagi ini...</div>`;
            await callGeminiAI("Teknik menulis novel secara umum untuk pemula", true);
            await setDoc(aiLogRef, { lastDate: today });
        }

        // --- FUNGSI INTI PANGGIL GEMINI ---
        async function callGeminiAI(topic, isDaily = false) {
            const prompt = `Buatlah satu artikel edukatif mendalam tentang teknik menulis NOVEL untuk penulis pemula dengan TOPIK: ${topic}. 
            Struktur Jawaban WAJIB:
            Baris 1: Judul Menarik (Tanpa tanda bintang atau #)
            Baris Berikutnya: Isi materi dalam format HTML (gunakan p, h3, blockquote untuk kutipan novel, ul, li).
            Berikan contoh 'Bedah Kutipan' dari sebuah novel terkenal. Penulis: Aksa AI.`;
            
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "Anda adalah Aksa, ahli kurasi novel di Cendekia Aksara." }] }
                    })
                });
                
                const data = await res.json();
                const result = data.candidates[0].content.parts[0].text;
                const lines = result.split('\n');
                const title = lines[0].replace(/#|\*/g, '').trim();
                const content = lines.slice(1).join('\n');

                await addDoc(collection(db, 'materials'), {
                    title, category: 'Artikel', topic: isDaily ? 'Harian AI' : 'Pesanan Khusus', content,
                    createdAt: serverTimestamp(), authorEmail: 'aksa-ai@cendekia.aksara',
                    imageUrl: 'https://images.unsplash.com/photo-1455390582262-044cdead277a?q=80&w=1000'
                });

                if (!isDaily) alert("Berhasil! Aksa AI baru saja menerbitkan artikel tentang: " + topic);
                loadMaterials();
            } catch (err) {
                console.error("AI Error:", err);
                if (!isDaily) alert("Gagal memanggil Aksa AI.");
            } finally {
                const statusBox = document.getElementById('ai-status-container');
                statusBox.innerHTML = '';
            }
        }

        // --- BUTTON HANDLER: MANUAL AI ---
        document.getElementById('btn-ai-manual').onclick = async function() {
            const topicInput = document.getElementById('ai-manual-topic');
            const topic = topicInput.value.trim();
            if (!topic) { alert("Masukkan topik dulu ya, Kak!"); return; }

            this.disabled = true;
            this.innerHTML = `<i class="fa fa-spinner fa-spin"></i> Memerintah Aksa...`;
            
            const statusBox = document.getElementById('ai-status-container');
            statusBox.innerHTML = `<div class="ai-indicator"><i class="fa-solid fa-robot fa-bounce"></i> Menjalankan perintah Kakak: Membedah topik "${topic}"...</div>`;

            await callGeminiAI(topic, false);

            this.disabled = false;
            this.innerHTML = `<i class="fa-solid fa-paper-plane"></i> Terbitkan via Aksa AI`;
            topicInput.value = '';
        };

        // --- FIREBASE LOGIC LAINNYA ---
        async function loadMaterials() {
            const q = query(collection(db, 'materials'), orderBy('createdAt', 'desc'));
            const snap = await getDocs(q);
            allMaterials = snap.docs.map(d => ({ id: d.id, ...d.data() }));
            renderPage();
        }

        function renderPage() {
            const articles = allMaterials.filter(m => m.category === 'Artikel').slice(0, 3);
            document.getElementById('featured-container').innerHTML = articles.map(item => `
                <div class="featured-card" onclick="openDetail('${item.id}')">
                    ${renderAdminActions(item)}
                    <div class="featured-img" style="background-image: url('${item.imageUrl || ''}')">
                        ${!item.imageUrl ? '<div class="featured-icon-fallback"><i class="fa-solid fa-feather"></i></div>' : ''}
                        <span class="badge">${item.topic || 'Sastra'}</span>
                    </div>
                    <div class="featured-content">
                        <div class="featured-date">${formatDate(item.createdAt)}</div>
                        <h3 class="featured-title">${item.title}</h3>
                    </div>
                </div>
            `).join('');
            filterMaterials('all');
        }

        function renderAdminActions(item) {
            if (!currentUser) return '';
            return `<div class="admin-actions">
                <button class="action-btn" style="background:white; color:var(--primary)" onclick="event.stopPropagation(); editMaterial('${item.id}')"><i class="fa-solid fa-pen"></i></button>
                <button class="action-btn" style="background:white; color:var(--danger)" onclick="event.stopPropagation(); deleteMaterial('${item.id}')"><i class="fa-solid fa-trash"></i></button>
            </div>`;
        }

        window.filterMaterials = function(f) {
            let items = allMaterials.filter(m => m.category !== 'Artikel');
            if (f !== 'all') items = items.filter(m => m.category === f);

            document.getElementById('library-container').innerHTML = items.map(item => `
                <div class="material-card" onclick="openDetail('${item.id}')">
                    ${renderAdminActions(item)}
                    <div class="material-thumb">
                        ${item.category === 'Video' ? `<img src="https://img.youtube.com/vi/${getYoutubeID(item.videoUrl)}/hqdefault.jpg">` : (item.imageUrl ? `<img src="${item.imageUrl}">` : '<i class="fa-solid fa-book-open" style="font-size:2rem; color:#ccc;"></i>')}
                    </div>
                    <div class="material-info">
                        <div class="material-type">${item.category} • ${item.topic || 'Novel'}</div>
                        <h3 class="material-title">${item.title}</h3>
                    </div>
                </div>
            `).join('');
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(f === 'all' ? 'Semua' : (f === 'Video' ? 'Video' : 'Analisis'))));
        }

        window.openDetail = function(id) {
            const item = allMaterials.find(m => m.id === id);
            document.getElementById('view-content-rendered').innerHTML = `
                <div style="border-bottom: 2px solid #eee; margin-bottom: 25px; padding-bottom: 15px;">
                    <span class="badge" style="position:static; margin-bottom:10px;">${item.topic || 'Materi'}</span>
                    <h1 class="detail-title">${item.title}</h1>
                    <p style="color:#888; font-size:0.9rem;">Diterbitkan pada ${formatDate(item.createdAt)} • Penulis: ${item.authorEmail}</p>
                </div>
                ${item.category === 'Video' ? `<div class="video-wrapper"><iframe src="https://www.youtube.com/embed/${getYoutubeID(item.videoUrl)}"></iframe></div>` : ''}
                <div class="detail-content">${item.content}</div>
            `;
            document.getElementById('public-view').classList.add('hidden');
            document.getElementById('detail-view').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        window.closeDetail = () => { document.getElementById('detail-view').classList.add('hidden'); document.getElementById('public-view').classList.remove('hidden'); };

        document.getElementById('btn-open-archive').onclick = () => {
            const groups = {};
            allMaterials.filter(m => m.category === 'Artikel').forEach(a => {
                const date = a.createdAt ? new Date(a.createdAt.seconds * 1000) : new Date();
                const key = date.toLocaleString('id-ID', { month: 'long', year: 'numeric' });
                if (!groups[key]) groups[key] = [];
                groups[key].push(a);
            });
            document.getElementById('archive-content').innerHTML = Object.keys(groups).map(k => `
                <div style="margin-bottom:30px;"><h3 style="color:var(--primary); border-bottom:1px solid #ddd;">${k}</h3>
                <div class="featured-grid">${groups[k].map(i => `<div class="featured-card" onclick="openDetail('${i.id}')"><div class="featured-content"><h3>${i.title}</h3></div></div>`).join('')}</div></div>
            `).join('');
            document.getElementById('public-view').classList.add('hidden');
            document.getElementById('archive-view').classList.remove('hidden');
        };

        window.closeArchive = () => { document.getElementById('archive-view').classList.add('hidden'); document.getElementById('public-view').classList.remove('hidden'); };

        function setupAuthListener() {
            onAuthStateChanged(auth, user => {
                currentUser = user;
                const panel = document.getElementById('admin-panel');
                if (user && user.email.endsWith('@ac.id')) {
                    panel.style.display = 'block';
                    document.getElementById('auth-section').innerHTML = `<div class="admin-trigger" onclick="signOut(auth).then(()=>location.reload())">Keluar (${user.email})</div>`;
                } else {
                    panel.style.display = 'none';
                    document.getElementById('auth-section').innerHTML = `<div class="admin-trigger" onclick="document.getElementById('login-modal').classList.add('show')"><i class="fa-solid fa-lock"></i> Akses Pengajar</div>`;
                }
                renderPage();
            });
        }

        document.getElementById('login-form').onsubmit = async e => {
            e.preventDefault();
            try { await signInWithEmailAndPassword(auth, document.getElementById('login-email').value, document.getElementById('login-password').value); document.getElementById('login-modal').classList.remove('show'); }
            catch { alert("Gagal!"); }
        };

        document.getElementById('material-form').onsubmit = async e => {
            e.preventDefault();
            const payload = {
                title: document.getElementById('input-title').value,
                category: document.getElementById('input-category').value,
                topic: document.getElementById('input-topic').value,
                videoUrl: document.getElementById('input-youtube').value,
                imageUrl: document.getElementById('input-image').value,
                content: document.getElementById('editor-area').innerHTML,
                authorEmail: currentUser.email,
                createdAt: serverTimestamp()
            };
            await addDoc(collection(db, 'materials'), payload);
            alert("Materi Manual Berhasil Terbit!");
            location.reload();
        };

        document.getElementById('input-category').onchange = function() { document.getElementById('video-url-group').style.display = this.value === 'Video' ? 'block' : 'none'; };
        function formatDate(ts) { return ts ? new Date(ts.seconds * 1000).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) : 'Baru saja'; }
        function getYoutubeID(u) { const m = u?.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/); return (m && m[2].length === 11) ? m[2] : null; }
        window.deleteMaterial = async id => { if(confirm('Hapus materi?')) { await deleteDoc(doc(db, 'materials', id)); location.reload(); } };
        document.getElementById('hide-admin-panel').onclick = () => document.getElementById('admin-panel').style.display = 'none';
    </script>
</body>
</html>
